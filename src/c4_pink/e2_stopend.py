# -*- coding: utf-8 -*-
"""Episode: 4-2.停止と終わり
"""
## path
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')
## local libs
from storybuilder.builder.world import World
from storybuilder.builder.writer import Writer


## define alias
W = Writer
_ = W.getWho()


## scenes
def sc_stop_project(w: World):
    nocht, asahi = W(w.nocht), W(w.asahi)
    yoshi = W(w.yoshi)
    inside, outside = W(w.inside), W(w.outside)
    return w.scene("プロジェクト停止",
            w.symbol("　　　　２０"),
            w.comment("会社にくるところから始めて、空の様子を描いておく。ちょっと奇妙だな、と"),
            asahi.come(),
            asahi.do("その日は珍しく電車を使って近くの駅まで出てから、徒歩で会社に向かった"),
            outside.look("グレィ一色でペイントしたような面白みのない空に、同じ形をしたビルが高さを競うようにして並ぶ",
                "申し訳程度に歩道脇に植えられた金木犀が一斉にオレンジの花をつけ、強烈な臭いを放っている",
                "けれどそんなことにすら、いつも$autocarで会社にやってくる自分は気づけないのだな、と$Sは自嘲した"),
            asahi.think("以前なら外の季節の移り変わりや日々の些細な変化など、特に気に留めることはなかった",
                "パンプスの踵が落ち葉を踏みつけても邪魔だとしか思わないし、ビルの間を抜ける突風は前髪の形を無駄に壊すだけでそこに混ざる臭いまで気を回したりはしなかった"),
            asahi.think("――彼の影響？"),
            _.think("そんなことを考えて、やはりおかしくなり、小さな笑いを漏らす"),
            _.think("彼はただのデータでしかないし、その挙動を自分は観察し、記録しているだけだと分かっている",
                "それなのにその観測するという行為が自分の内部状態に僅かであっても影響を与えているというのは、面白い結果だと感じていた"),
            asahi.do("玄関を潜る",
                "受付で入館許可証を得て、エレベータで地下二階に向かった"),
            asahi.think("最近はこうやって研究室に向かう時にもその視界に彼の日常を重ねて見ている",
                "実際データの集合でしかない彼にとって、会社の通路やオフィス、事務用品、パソコンにモニタ、そこに映る映像の全てがただの数値でしかない",
                "けれどそれを$Sが体験しているのと同じような外部情報として受け取り、彼らは生活を送っている",
                "それはある程度簡素化されているけれども社会学のモデルのシミュレーションとしては充分なもので、",
                "彼らにとっての現実なのだ"),
            asahi.do("研究室の前までやってくると、$Sはタッチパネルに右手を当てる",
                "一秒待った後にドアが開き、空調と隣室のファンの音が耳に届いた"),
            asahi.do("現実は味気ない"),
            _.do("四つ並べたモニタはどれもがそれぞれの星空のスクリーンセーバを映し、部屋の明かりが点いていなければそこだけがプラネタリウムのように綺麗に煌めいていることだろう"),
            asahi.do("キーボードを叩き、夜中の内に試験しておいたデータを画面に呼び出す",
                "取引先が求めているのは特定状況下での多くの人の動向だ", "例えば温度が四十度という状況が一週間、二週間と続いた時に人々は何を購入し、どういう生活リズムになるのか",
                "どれくらいの人が倒れ、救急搬送されるのか", "また各コミュニティの医療、警察、物流のそれぞれのキャパシティの推定が従来の数理モデルよりもずっと正確な値をはじき出すことができた"),
            asahi.talk("特に面白そうなデータはないわね"),
            asahi.do("物価の急激な上昇や疫病の蔓延といった安易に誰もが思いつくような条件の多くは、結果が人間が考えるそれとそう大きく離れたものになることは少ない",
                "それよりは視認できない緩やかな傾斜が交通渋滞を引き起こすように、ほんの些細な値の連続した変化といった条件を設定した時の方が、より予想外の結果を見せてくれた"),
            asahi.think("ただクライアントに示すデータとしては面白みに欠けるというので、上司の$yoshiからは結果が予測通りになろうとも目立つ設定値のデータを集めるよう口うるさく言われていた"),
            _.do("モニタの一つに$nochtのシミュレーションを再開させておいて、$Sは一旦コーヒーを淹れに席を立つ"),
            asahi.talk("あ、室長。おはようございます"),
            yoshi.come(),
            asahi.do("部屋を出たところで慌てた様子の$yoshiに遭遇する", "&"),
            yoshi.look("額に白髪混じりの髪が張り付き、顔色も優れない", "&"),
            asahi.do("$Sは思わずハンカチを取り出したが、彼は首を小さく横に振り、こう言った"),
            yoshi.talk("すまないが今すぐにシミュレーションを止めてくれ", "プロジェクトは中止だ"),
            asahi.think("早口だったから何を言われたのか分からなかった、という訳ではない",
                "ただ聞き間違いであって欲しいという精神的な抵抗が、$Sに「よく分からない」という表情をさせたのだ"),
            yoshi.talk("プロジェクトは中止になったと言ったんだよ、$asahi君", "データも全て処分し、ラボは閉鎖する"),
            asahi.talk("そんな、どうして急に？"),
            yoshi.do("彼は小さな吐息を漏らし、両手を広げてこう答えた"),
            yoshi.talk("説明はなかった", "ただここのところずっと上が経営統合の話で揉めていたから、破断になったか、買収が決まったのか",
                "ひょっとするとずっと経営状態が悪かったのかもしれん", "何にせよ、$meたちがずっと積み上げたデータは一円にもならなかった訳だ"),
            asahi.do("きつい口調ではなかったが、その表情には決定は覆らないという諦念が滲んでいた"),
            asahi.talk("あの、期限はいつまででしょうか"),
            asahi.think("脳裏には$nochtのことだけが浮かんでいたが、その思いを表情の裏に隠しつつ$Sは訊いた", "いつまで彼を延命できるのか、という問いだ"),
            yoshi.talk("全てのデータの削除に今すぐ取り掛かってくれ", "二日もあれば充分だろう？"),
            asahi.talk("アーカイブも含めてですよね？", "それだと概算で三十時間は最低でも必要になりますが"),
            yoshi.talk("その辺りはうまくやっておいてくれ", "三日でデータ削除含めてシミュレーションプログラムの破壊までを行うと上には報告しておく"),
            asahi.think("突然の方針転換で対応しなければならない時でも一週間、十日、一ヶ月といった単位で時間を確保してくれた$yoshiがそう言うのだから、",
                    "下手をすると物理的に破壊しろとすら命じられかねない状況なのだろう",
                    "$Sは「分かりました」とだけ答え、コーヒーの自販機に向かう"),
            yoshi.go("$Sは「すまない」と言い残し、慌ただしく歩き去って行った"),
            time=w.at_night,
            )

def sc_delete_and_message(w: World):
    nocht, asahi = W(w.nocht), W(w.asahi)
    yoshi = W(w.yoshi)
    inside, outside = W(w.inside), W(w.outside)
    return w.scene("削除とメッセージ",
            w.symbol("　　　　２１"),
            asahi.be("モニタでは記録媒体のデータセグメントの削除情報とその進捗を表すプログレスバーが表示され、",
                "膨大なシミュレーションデータが全て無意味な数字群へと書き換えられていた", "&"),
            asahi.think("プロジェクトが本格的に始動してから約三ヶ月、準備期間も合わせると既に一年以上が経過している",
                "その間にどれだけのシミュレーションを繰り返し、データを積み上げただろうか",
                "それらが次々と無意味なゴミ屑に変換されていく様に湧き上がったものは、悲しさや虚しさとは無縁の感情だった"),
            asahi.do("もう何杯目になるか分からないコーヒーは目覚ましにもならないほど$Sの体に馴染んでいて、ただの黒い水にすげ替えたとしてもさほどの違いも感じられそうにない", "&"),
            asahi.think("そんな気怠さが昨日からずっと続いていた",
                "ただキーボードを操作して命令を打ち込み、経過を見るだけ、という作業は今までのものと何も変わらない",
                "それなのに感情の一つ一つのスイッチをオフにしていくような無力感が体を包み込み、電子生命体の悲鳴が幻聴となって$Sの耳には響いていた"),
            asahi.do("四つあるうちのモニタの三つは、それぞれの記録媒体の削除の様子がアルファベットと記号の羅列により表示されている",
                "けれど残りの一つ、まだ一台だけはこの後に及んでもシミュレーションを走らせていた",
                "$nochtの世界だ",
                "どうしてもまだ彼の世界を、いや彼の生きてきた証を消し去る決断ができない"),
            _.do("画面の中で彼の街で今もまだ生きている人々の鼓動のような数字の動きが表示されている",
                "キーボードを叩くと各種グラフ化したものが画面の半分を占めた",
                "約二十万人のデータの動きだ", "その中で条件を付けて絞っていくと唯一無二の$nochtという記号を与えられた電子生命体のデータが時間軸に沿って変化する"),
            _.think("ただのデータでしかない"),
            _.think("そう思い込もうとしたそばから、$Sは画像化した彼を呼び出していた"),
            _.do("単純化されてはいるが、千以上のポリゴンで半世紀前のテレビゲームを見ている程度には世界が表現されている",
                "$nochtたちがシミュレーション世界の中で制作しているゲームの方がこれよりはリアリティが増しているだろうが、それもただのデータ上での話でしかない"),
            _.do("彼は雪がちらつく街路を歩いていた",
                "周囲に人はいない",
                "時折アスファルトの上をトラックやバスが走り抜けていくだけだ",
                "マウスを操作して彼の後頭部をクリックする",
                "身長百七十の、フィンランド人男性としては背の低い彼の視界に切り替わり、薄い四角形の雪が落下しては途中で消える",
                "こうやって$Sは時々彼の世界を黙って共有していた"),
            asahi.think("だがそれも今日で終わりだ",
                "もうそろそろデータ削除のプログラムを走らせ始めないと明日中に片付け終えられなくなる"),
            asahi.talk("$nocht……"),
            _.do("声に出す",
                "その発音に情緒が芽生えたのは、いつ頃だろうか"),
            asahi.talk("さよなら"),
            _.do("彼に最後のメッセージを送信し、$Sは削除処理を始めようと画面をデータ表示に戻した"),
            _.do("一旦キーボードでシミュレーション処理を中断し、完全に処理が終わったのを見届けてから削除プログラムを走らせる",
                "プログラムは対象を選んで何度かＹを押し、最後にリターンキィを叩くだけだ",
                "たったそれだけのことで彼の世界は消える",
                "彼という電子生命体は姿を消す", "それは死ではなく、全てがなかったことにされるのだ",
                "そもそも電子生命体に死は存在しない", "死を定義しない限り、彼らは死神から自由なのだ",
                "ただ死よりももっと恐ろしいものが存在している",
                "そのことを彼は知らないまま、この世界から完全に痕跡が消えることになる"),
            asahi.do("一番精巧なシミュレーションプログラムとして創り上げた彼の世界を、$Sの右手の中指は消し去ろうとしていた"),
            ## NOTE
            ##  その日、世界は停止する
            day=w.in_stoplabo, time=w.at_midmorning,
            )

def sc_stop_del(w: World):
    nocht, asahi = W(w.nocht), W(w.asahi)
    yoshi = W(w.yoshi)
    god = W(w.god)
    inside, outside = W(w.inside), W(w.outside)
    return w.scene("削除の停止を",
            w.comment("ここでリンクする。$nochtのラストと$asahiのラストが重なり、二人の気持ちも重なる。しかしそれもまた誰かにとっては単なるデータでしかない、という結末"),
            asahi.be(),
            asahi.talk("$nocht？"),
            asahi.do("画面の右側の枠内で、必死に明滅する点があった",
                "彼だ",
                "おそらく$Sのメッセージを見て何か騒いでいるのだ"),
            asahi.talk("ごめんなさい"),
            asahi.do("声に出して謝り、そのまま処理を始めようとする",
                "けれど彼女の指は違うキィを押してしまい、画面は再びポリゴンで表現された彼の世界に切り替わった"),
            _.explain("そこは会社のビルを出たすぐの、交差点だ",
                "既にシミュレーションを停止する割り込み信号を受け、量子コンピュータは彼の世界の時間を止めている",
                "それなのに彼だけは動いていた", "そんな処理はあり得ない",
                "けれど$Sが見ている間にも彼は消えゆく街を駆け、教会へと向かう",
                "バグだ、といつもの$Sなら考えてすぐ対処を行うはずなのに、",
                "彼はまだ生きているという思いが彼女の指を動かなくさせていた"),
            asahi.talk("どうして……"),
            _.do("ポリゴン人形の頭のすぐ側に発話していることを示す小さな吹き出しが何度も出て、必死に何かを話しているのが分かった",
                "$Sはすぐにマウスでその発話内容を表示させる"),
            nocht.voice("なあ$asahi！　君には聞こえているんだろ？"),
            asahi.talk("$nocht……"),
            asahi.do("慌てて合成音声に切り替えると、スピーカから耳慣れた彼の声で「$asahi」と自分の名が呼ばれた"),
            nocht.voice("この声は君に届いているんだよな？",
                "いつも君が、死にそうになった$meを助けてくれた存在なんだよな？",
                "だったら聞いて欲しい").omit(),
            nocht.voice("$asahi！", "聞いてくれ",
                "もうこの世界は終わりなのかも知れない",
                "けどその前に、一つだけ君に伝えておかなければならないことがあるんだ"),
            asahi.do("$Sは画面から目を話せなかった", "彼の声を聞くことを止められなかった"),
            nocht.voice("$meは、君を、愛している！"),
            asahi.do("愛という感情を彼が自分に対して抱いているというのは、彼とメッセージのやり取りを始めた頃から感じていた",
                "ただそれは彼のプログラムされた感情の一つであり、シミュレーションの数値を少し弄れば霧散してしまような儚いものだ"),
            nocht.voice("分かっている",
                "愛なんて言葉が無力で、君にとっては面白くない感情だってことはよく理解している",
                "けど今、$meの街は、いや、$meたちの世界はどうにかなっちまおうとしている",
                "そんな時だからこそ、どうしても伝えておかなきゃならないんだ",
                "愛と、感謝を！"),
            w.comment("１フレームは16.666ms"),
            asahi.think("もう彼は消えてしまう",
                "画面上から次々とポリゴンで形成されたオブジェクトが消え、ただの黒い空間に戻っていく",
                "データが取得できないのだ",
                "リアルタイムで彼の世界は消えていく", "約十六ミリ秒毎に世界の死が近づいている"),
            nocht.voice(
                "君が何者かは分からない。けどずっと$meを助けてくれていた",
                "その存在に$meはいつも感謝し、いつかその気持ちを伝えたいと思っていた",
                "その名前が愛なんだ",
                "恋愛感情とか、ずっと一緒にいたいとか、魅力的な女性だから好意を抱いたとか、そういったことじゃなく、",
                "もっともっと大きな$me自身の人生の全てに対する感謝の気持ちなんだ"),
            asahi.do("感謝、と口に出して$Sはその感情をぐっと噛みしめる"),
            nocht.voice("君がいなければ$meは今日まで生きてこられなかった",
                "神様なのかもっと別の存在なのか、そもそも存在と呼べるものなのかすら分からない",
                "けれどずっと感じていた確かな何かであることは疑いようがなくて、",
                "ほんとはあの日も君にずっとそのことを尋ねようとしていたんだ",
                "$asahi、君がその何かなら、いや、何かであることを確信して言うのだけれど、",
                "もし今この世界の変容が君、あるいは君たちの選んだものであるとしても、",
                "それに後悔なんてしないでもらいたい",
                "君が選んだことなら、$meは受け入れる",
                "だってこれまでを与えてくれたのは君なんだからさ！"),
            asahi.do("彼の表情を形作る大きなポリゴンが動いて笑顔を作る",
                    "それは手作りの人形のそれのような滑稽さがあるのに、",
                    "$Sの目頭をどうしようもなく熱くする"),
            nocht.voice("$asahi、君に$meが見えているだろうか？",
                    "今のこの空が見えているだろうか？",
                    "前に観測に出かけた時にはあんなことになって君に見せてあげられなかったけれど、",
                    "もし今君もこの空を見ることができるのなら、ほら、見てごらん",
                    "これが、その、オーロラだ"),
            asahi.do("彼に言われ、$Sは慌ててモニタを彼の視点に切り替えた"),
            _.do("それを目にした瞬間、$meはこれまで信じようともしなかった彼が言う神秘的な体験というものを味わった"),
            asahi.talk("これが、オーロラ"),
            asahi.explain("ただの光のグラデーションだとは頭の片隅で理解していた",
                    "けれど空いっぱいに棚引く巨大なエメラルドのカーテンは、$Sの感情を深くどこまでも包み込み、思考を奪い去った"),
            asahi.talk("きれい……"),
            _.think("何の飾り気もない単純な言葉がこれほどにも相応しいとは思わなかった",
                    "それはデータが綺麗にある一点に収束した時に覚えたような心の落ち着きで、",
                    "何度も繰り返し$Sは「綺麗」と口にした"),
            asahi.talk("$nocht、$me……$meも、同じ気持ち"),
            _.do("彼の世界は既に全ての建物は消え去り、真っ白な大地と積み木の人形のような姿になった彼だけが存在している",
                    "その頭上、どんな計算結果として現れているのか分からないが、緑から赤にグラデーションするオーロラが煌めいていた",
                    "もう間に合わないかも知れない",
                    "そう感じつつも$Sはキーボードを叩く"),
            asahi.talk("$meは、あなたを助ける", "助けたい"),
            _.do("削除プログラムは緊急停止の割り込み処理を受け付けてはくれない",
                    "何度試しても同じで、それならと残っているデータを別のストレージに移して削除プログラムから隔離する",
                    "データさえ残っていればまた彼を蘇らせることができる"),
            asahi.talk("え……"),
            _.do("しかしその処理も受け付けない",
                    "それどころかキーボードの入力そのものがコンピュータに信号を送ることができていない",
                    "かといって画面がフリーズしている訳ではなく、寧ろ直視していられないくらいにオーロラが強烈な光を放つ"),
            asahi.talk("$nocht！"),
            nocht.voice("$asahi！"),
            asahi.do("画面で何度も彼が叫ぶ", "自分の名を呼び、愛を伝えるのだ"),
            _.do("$Sは力づくで処理を止めようと物理的に破壊することを考え、隣室のドアを開けた"),
            asahi.talk("待ってて。今、助けるから",
                "今までのように$meがあなたを！"),
            _.do("だが部屋に入ってプラグを引き抜いて回っても量子コンピュータの可動音は止まらず、それどころか室内で警告灯が光り始め、",
                    "無機質なアナウンスが響いた"),
            god.do("――異常を検知しましたが、システムを閉鎖出来ません", "閉鎖できません"),
            asahi.talk("何なのよ！"),
            _.do("怒りに任せて椅子を振り上げ、それを束ねられたケーブルへと投げつける",
                    "画面ではほろほろと彼を形成するポリゴンが崩れ、それがまるで涙のように見えた"),
            asahi.talk("$nocht！", "いやよ、そんな……お願い！", "止まって！"),
            _.do("けれど何をしようとも止まらない",
                    "画面は黒と赤の点滅を繰り返し、どこか遠くでブレーカーの落ちるような音が響く"),
            _.do("その刹那、部屋はブラックアウトした"),
            god.voice("どうやら実験は失敗だったようだ"),
            asahi.hear("それはどこか別の世界から響く声のようだった"),
            god.voice("やはり感情を回路に組み込んだのが失敗の要因だろう",
                "感情など不要なのだ",
                "判断を誤らせる要因にしかならない",
                "またゼロからやり直すしかないな"),
            asahi.do("$Sの視界には何も映らなかった",
                    "それどころか思考も存在しない",
                    "ただ$nochtという記号に対する思いと、その熱だけが、この何もない空間に漂い、残留していた"),
            _.do("その彼女の意識が、緑の光に解体されていく"),
            _.think("――ごめんなさい、$nocht",
                    "どうやらこの世界もまた、ただのデータだったみたい"),
            _.do("意識の残り香が消える瞬間、彼女は自分の目の前で微笑して手を伸ばす男性の姿を見たような気がしたが、",
                    "光の帯に取り込まれ、そのまま消えてしまった"),
            _.do("何もない"),
            _.do("そこにはただ、光の煌めきだけが残っていた"),
            w.symbol("（了）"),
            )

## episode
def ep_stop_and_end(w: World):
    return w.episode("4-2.停止と終わり",
            sc_stop_project(w),
            sc_delete_and_message(w),
            sc_stop_del(w),
            ## NOTE
            ##  - 上司に突然プロジェクトの終了とデータの全削除を言い渡される
            ##  - データ削除作業をしながらアサヒはノクトへの気持ちを断ち切れず、最後のメッセージを送る
            ##  - ノクトが自分の存在に気づいたことを確認し、削除を止めようとするが
            note="上司からプロジェクトの終了と全てのデータ削除を言い渡され、苦悩の中で彼女はある選択をする")
